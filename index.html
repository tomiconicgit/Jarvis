<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Mobile 3D Tower Modeler</title>
  <!-- Load Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Base styles from original file */
    html, body { 
      margin: 0; 
      padding: 0; 
      overflow: hidden; 
      height: 100%; 
      width: 100%; 
      background: #111; 
      font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    #canvas-container { 
      position: fixed; 
      inset: 0; 
      z-index: 1; 
    }
    canvas { 
      display: block; 
      width: 100%; 
      height: 100%; 
    }
    /* Prevent blue flash on tap and text selection */
    * { 
      -webkit-tap-highlight-color: transparent; 
      user-select: none; 
      -webkit-user-select: none; 
    }

    /* --- UI Panel Styling --- */
    #loading-screen { 
      position: fixed; 
      inset: 0; 
      background: #1a1a1a; 
      color: #fff; 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      font-size: 1.5rem; 
      z-index: 1000; 
      transition: opacity 0.5s ease; 
    }
    .ui-panel { 
      position: fixed; 
      background: rgba(30, 30, 30, 0.85); 
      backdrop-filter: blur(10px); 
      -webkit-backdrop-filter: blur(10px); 
      border-radius: 12px; 
      z-index: 10; 
      transition: transform 0.3s ease-out, opacity 0.3s ease-out; 
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); 
    }
    
    /* --- Slider Styling --- */
    input[type="range"] { 
      -webkit-appearance: none; 
      appearance: none; 
      width: 100%; 
      height: 8px; 
      background: #4a5568; 
      border-radius: 4px; 
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb { 
      -webkit-appearance: none; 
      width: 24px; 
      height: 24px; 
      background: #3b82f6; 
      border-radius: 50%; 
      border: 2px solid #fff; 
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.5); 
      cursor: pointer;
    }
    input[type="range"]::-moz-range-thumb { 
      width: 24px; 
      height: 24px; 
      background: #3b82f6; 
      border-radius: 50%; 
      border: 2px solid #fff; 
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.5); 
      cursor: pointer;
    }
    
    /* --- Message Box --- */
    #message-box { 
      position: fixed; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, -50%) scale(0.9); 
      background: rgba(40, 40, 40, 0.9); 
      color: #fff; 
      padding: 20px 30px; 
      border-radius: 12px; 
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4); 
      z-index: 1001; 
      opacity: 0; 
      visibility: hidden; 
      transition: all 0.2s ease-out; 
      text-align: center; 
      backdrop-filter: blur(5px); 
    }
    #message-box.show { 
      transform: translate(-50%, -50%) scale(1); 
      opacity: 1; 
      visibility: visible; 
    }

    /* New: Ensure bottom bar stays on top */
    #bottom-bar {
      z-index: 20;
    }
  </style>
</head>
<body class="bg-gray-900 text-white">

  <!-- 3D Canvas Container -->
  <div id="canvas-container"></div>
  
  <!-- Loading Screen -->
  <div id="loading-screen"><div>Loading 3D Environment...</div></div>
  
  <!-- Message Box -->
  <div id="message-box"><p id="message-text">This is a message!</p></div>

  <!-- Bottom UI Bar -->
  <div id="bottom-bar" class="ui-panel bottom-4 left-1/2 -translate-x-1/2 flex items-center space-x-4 p-3 rounded-full">
    <!-- Add Object Button -->
    <button id="add-btn" class="w-14 h-14 bg-blue-600 rounded-full flex justify-center items-center shadow-lg active:scale-90 transition-transform">
      <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v12M6 12h12"/></svg>
    </button>
    <!-- Transform Tools Button -->
    <button id="tools-btn" class="w-14 h-14 bg-gray-700 rounded-full flex justify-center items-center shadow-lg active:scale-90 transition-transform">
      <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
    </button>
  </div>

  <!-- Add Object Panel -->
  <div id="add-panel" class="ui-panel bottom-24 left-4 right-4 p-4 transform translate-y-full opacity-0" style="visibility:hidden;">
    <h3 class="text-lg font-bold mb-4">Add Object</h3>
    <!-- Grid for object buttons -->
    <div class="grid grid-cols-3 gap-4">
      <!-- Button to add Tower Base WITH door -->
      <button id="add-tower-door-btn" class="bg-gray-700 p-3 rounded-lg flex flex-col items-center active:scale-90 transition-transform">
        <svg class="w-12 h-12 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 7v10l8 4 8-4V7L12 3 4 7zm0 0l8 4 8-4m-8 4v10m6-10.5v4h-4v-4h4z"></path></svg>
        <span class="text-xs font-medium text-center">Tower Base (Door)</span>
      </button>
      <!-- Button to add Tower Base WITHOUT door -->
      <button id="add-tower-solid-btn" class="bg-gray-700 p-3 rounded-lg flex flex-col items-center active:scale-90 transition-transform">
        <svg class="w-12 h-12 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4M4 7v10l8 4M4 7l8 4"></path></svg>
        <span class="text-xs font-medium text-center">Tower Base (Solid)</span>
      </button>
      <!-- Button to add Double Door -->
      <button id="add-double-door-btn" class="bg-gray-700 p-3 rounded-lg flex flex-col items-center active:scale-90 transition-transform">
        <svg class="w-12 h-12 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 4H6a2 2 0 00-2 2v12a2 2 0 002 2h2m8-16h2a2 2 0 012 2v12a2 2 0 01-2 2h-2M4 10h4m8 0h4M4 14h4m8 0h4M10 4v16m4-16v16"></path></svg>
        <span class="text-xs font-medium text-center">Double Door</span>
      </button>
    </div>
    <button id="close-add-panel" class="absolute top-2 right-2 w-8 h-8 bg-gray-600 rounded-full flex justify-center items-center text-2xl font-bold">&times;</button>
  </div>

  <!-- Properties Panel -->
  <div id="props-panel" class="ui-panel bottom-0 left-0 right-0 h-[45vh] max-h-[45vh] p-4 transform translate-y-full opacity-0" style="visibility:hidden; z-index: 15;">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-bold">Properties</h3>
      <button id="close-props-panel" class="w-8 h-8 bg-gray-600 rounded-full flex justify-center items-center text-2xl font-bold">&times;</button>
    </div>
    <!-- Sliders will be dynamically injected here -->
    <div id="props-content" class="space-y-4 overflow-y-auto max-h-[calc(45vh-4rem)] pr-2">
      <!-- Example: <p>Select an object to edit.</p> -->
    </div>
  </div>

  <!-- 
    IMPORT MAP:
    Tells the browser where to find the "three" modules.
  -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.180.0/build/three.module.js",
      "three/examples/jsm/controls/OrbitControls.js": "https://cdn.jsdelivr.net/npm/three@0.180.0/examples/jsm/controls/OrbitControls.js",
      "three/examples/jsm/controls/TransformControls.js": "https://cdn.jsdelivr.net/npm/three@0.180.0/examples/jsm/controls/TransformControls.js",
      "three/examples/jsm/environments/RoomEnvironment.js": "https://cdn.jsdelivr.net/npm/three@0.180.0/examples/jsm/environments/RoomEnvironment.js"
    }
  }
  </script>

  <!-- Main application logic -->
  <script type="module" src="main.js"></script>

</body>
</html>