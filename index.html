<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Iconic Editor — Hybrid Three.js</title>
  <meta name="theme-color" content="#0a0a0a" />

  <!-- IMPORTANT: use CORS-friendly CDN + anonymous CORS -->
  <script src="https://unpkg.com/es-module-shims@1.9.0/dist/es-module-shims.js" crossorigin="anonymous"></script>

  <!-- Switch imports to jsDelivr to avoid CORS issues on submodule loads -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
    }
  }
  </script>

  <style>
    :root{
      --bg:#121212; --panel:#1E1E1E; --panel-border:#2A2A2A;
      --text:#F5F5F5; --muted:#888; --accent:#4da3ff; --toolbar:#1E1E1E; --input-bg:#252525;
      --panel-w:340px; /* Reduced panel width */
      --radius-sm: 4px; /* For buttons/inputs */
      --radius-md: 0px;  /* For containers */
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);
      font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif
    }
    html,body,#viewport{overscroll-behavior:none}

    .app{position:fixed;inset:0;display:grid;grid-template-rows:48px 1fr;min-height:0}
    #toolbar{
      background:var(--toolbar);border-bottom:1px solid var(--panel-border);
      display:flex;align-items:center;gap:12px;padding:0 12px 0 16px;user-select:none
    }
    #toolbar .menu{
      font-weight:600;cursor:pointer;
      padding: 4px 8px; border-radius: var(--radius-sm);
    }
    #toolbar .menu:hover{background:rgba(255,255,255,.08)}

    #main{display:grid;grid-template-columns:1fr var(--panel-w);min-height:0}
    #viewport{position:relative;min-height:0}
    #panel{
      border-left:1px solid var(--panel-border);background:var(--panel);
      min-width:260px;display:flex;flex-direction:column;min-height:0;overflow:hidden;
    }
    
    /* --- New Panel Tab Styles --- */
    #panel-tabs{ display:flex; background:var(--bg); border-bottom:1px solid var(--panel-border); user-select:none; }
    .panel-tab{
      padding: 10px 16px; font-weight:600; cursor:pointer;
      opacity:.5; border-bottom:2px solid transparent;
    }
    .panel-tab.active{ opacity:1; border-bottom-color:var(--accent); }
    .panel-tab:hover{ background:rgba(255,255,255,.03); }

    /* Panel Panes */
    .panel-pane{ display:none; flex:1; min-height:0; overflow:auto; }
    .panel-pane.active{ display:block; }
    #pane-scene{ padding: 16px; }
    #pane-transform{ padding: 16px; }
    /* --- End New Panel Tab Styles --- */

    @media (max-width:768px){
      :root{ --panel-w: auto; }
      #main{
        grid-template-columns:1fr;
        grid-template-rows:60vh 40vh;
      }
      #panel{border-left:none;border-top:1px solid var(--panel-border)}
      #pane-scene, #pane-transform {padding: 12px;}
    }

    canvas{display:block;width:100%;height:100%;touch-action:none}

    .group{
      border:1px solid var(--panel-border);
      border-radius:var(--radius-md);
      background:rgba(255,255,255,.03);
      padding:16px;margin:12px 0;
    }
    .group h3{
      margin:0 0 12px 0;font-size:12px;
      font-weight:600;text-transform:uppercase;
      letter-spacing:.5px;opacity:.7;
    }
    .list{
      border:1px solid var(--panel-border);
      border-radius:var(--radius-md);
      overflow:hidden;
    }
    .item{padding:10px 12px;border-bottom:1px solid var(--panel-border);cursor:pointer}
    .item:last-child{border-bottom:0}
    .item.active{background:rgba(77,163,255,.12)}
    
    .row{display:grid;grid-template-columns:110px 1fr;gap:8px;align-items:center;margin:10px 0}
    .row.simple{grid-template-columns:110px 1fr;}
    .row label{color:var(--muted);font-size:13px;white-space:nowrap;opacity:.9}
    
    select, input[type="color"]{
      width:100%;background:var(--input-bg);border:1px solid var(--panel-border);
      border-radius:var(--radius-sm);
      color:var(--text);padding:8px 12px;
    }
    input[type="color"]{ min-height: 38px; }

    .row.slider{
      grid-template-columns: 24px 1fr 60px;
      gap: 8px; margin: 10px 0;
    }
    .row.slider label{
      font-weight:600; color:var(--text); text-align:center;
      opacity: .8; font-size: 13px;
    }
    .row.slider input[type="range"]{
      width:100%; margin:0; accent-color: var(--accent);
    }
    .row.slider input[type="number"]{
      width:100%; padding: 4px 8px; font-size: 13px;
      background:var(--input-bg); border:1px solid var(--panel-border);
      border-radius:var(--radius-sm); color:var(--text); -moz-appearance: textfield;
    }
    .row.slider input[type="number"]::-webkit-outer-spin-button,
    .row.slider input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    
    button{
      appearance:none;
      background:var(--input-bg);
      border:1px solid var(--panel-border);
      color:var(--accent);
      border-radius:var(--radius-sm);
      padding:9px 14px;
      font-weight:600;
      cursor:pointer;
      transition:background .15s, border-color .15s;
    }
    button:hover{
      background:var(--input-bg);
      border-color:var(--accent);
    }
    button.primary{
      background:var(--accent);
      border-color:var(--accent);
      color:var(--bg);
    }
    button.primary:hover{
      background: #6ab0ff;
      border-color: #6ab0ff;
    }

    /* Loader */
    #loader{position:fixed;inset:0;background:#0a0c10;display:flex;flex-direction:column;
      align-items:center;justify-content:center;z-index:999}
    #logo{width:120px;height:120px;margin-bottom:18px}
    #bar{width:min(520px,80vw);height:10px;border-radius:var(--radius-sm);border:1px solid rgba(255,255,255,.2);overflow:hidden}
    #bar > span{display:block;height:100%;width:0;background:linear-gradient(90deg,#4da3ff,#77c1ff)}
    #status{margin-top:8px;color:#cdd6e6;font:12px ui-monospace,monospace}
  </style>
</head>
<body>
  <noscript style="color:#fff">This app requires JavaScript.</noscript>

  <div id="loader" aria-busy="true">
    <svg id="logo" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="Iconic">
      <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#4da3ff"/><stop offset="1" stop-color="#8fd1ff"/></linearGradient></defs>
      <circle cx="50" cy="50" r="46" stroke="url(#g)" stroke-width="4"/>
      <path d="M26 70 L50 22 L74 70" stroke="url(#g)" stroke-width="6" stroke-linecap="round"/>
    </svg>
    <div id="bar"><span></span></div>
    <div id="status">loading…</div>
  </div>

  <div class="app" id="app" hidden>
    <div id="toolbar"></div>
    <div id="main">
      <div id="viewport" role="application" aria-label="3D viewport"></div>
      <aside id="panel"></aside>
    </div>
  </div>

  <!-- Optional: warn if opened as file:// which breaks CORS for modules -->
  <script>
    if (location.protocol === 'file:') {
      console.warn('[Iconic] Open via http://, not file:// — modules need CORS headers.');
    }
  </script>

  <script type="module" src="./src/main.js"></script>
</body>
</html>